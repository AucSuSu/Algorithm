# 데드락
![alt text](https://mblogthumb-phinf.pstatic.net/MjAyMDA3MDFfMjU0/MDAxNTkzNTkxODQ4NTAz.ed7sszaC38N9sbRCf3MBhFpNKR3sVqdaDTot-TMwOawg.OCAOmiTC8ZrINMsrW0w4Fy_DLgN1uMz2TcFljSLD8hsg.JPEG.smc503/%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C.jpg?type=w800)

위의 그림을 보면 중간의 4개의 자동차가 서로 비키길 기다리고있다.

# 데드락이란?

>두개 이상의 프로세스 또는 스레드가 자원을 점유한 채로 타 프로세스의 자원을 요구하며 무한히 기다리는 상태

예시를 보자.

![](https://t1.daumcdn.net/cfile/tistory/243E89355714C26E28)

프로세스 1과 2가 자원 1,2를 모두 얻어야 한다는 상황을 가정해보자.

t1 : 프로세스1이 자원1을 얻음 / 프로세스2가 자원 2를 얻음

t2 : 프로세스1은 자원2를 기다림 / 프로세스2는 자원1을 기다림


# 데드락 발생 조건
4가지 모두 성립해야 데드락이 발생한다.

1. 상호 배제(Mutual exclusion)
 - 자원은 한번에 한 프로세스만 사용할 수 있음

2. 점유 대기(Hold and wait)
- 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용하고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 존재해야 함

3. 비선점(No preemption)
- 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 빼앗을 수 없음

4. 순환 대기(Circular wait)
- 프로세스의 집합에서 순환 형태로 자원을 대기하고 있어야 함.

# 데드락 해결 방법

## 예방
교착 상태 발생 조건 중 하나를 제거하면서 해결한다 (자원 낭비 엄청 심함)
- 상호배제 부정 : 여러 프로세스가 공유 자원 사용
- 점유대기 부정 : 프로세스 실행전 모든 자원을 할당
- 비서점 부점 : 자원 점유 중인 프로세스가 다른 자원을 요구할 때 가진 자원 반납
- 순환대기 부정 : 자원에 고유번호 할당 후 순서대로 자원 요구

## 회피
교착 상태 발생 시 피해나가는 방법
### 은행원 알고리즘
은행에서 모든 고객의 요구가 충족되도록 현금을 할당하는데서 유래.

>프로세스가 자원을 요구할 때, 시스템은 자원을 할당한 후에도 안정 상태로 남아있게 되는지 사전에 검사하여 교착 상태 회피하는 기법.

안정 상태에 있으면 자원을 할당하고, 그렇지 않으면 다른 프로세스들이 자원을 해지할 때까지 대기함.

### 자원 할당 그래프 알고리즘
그래프에 요청 간선과 할당 간선을 두어, 사이클을 구축하고, 한 가지의 자원 유형의 두 가지 이상의 사례가 존재하면, 데드락이라 판단하고 그래프의 간선을 조정하는 알고리즘.

## 탐지 및 회복
데드락을 허용하고 이를 탐지하며, 발생 시 회복절차를 수행한다. 이 방식은 성능에 영향을 줄 수 있다.
- 탐지 : 자원 요청 시 데드락 탐지 알고리즘을 통하여, 현재 시스템 자원의 데드락 여부를 탐지
- 회복 : 데드락 탐지 시 프로세스 종료, 자원 할당의 해제 또는 자원의 선점을 통한 회복 절차 수행
