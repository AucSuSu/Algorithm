# 공유 자원 관리를 위해 상호 배제를 달성하는 기법: 뮤텍스, 세마포어
동시성 프로그래밍에서는 '공유 자원 관리'가 가장 중요<br>
➡️ <b>상호배제(Mutual exclusion)</b>을 달성하는 기법이 필요<br>
➡️ <b> 뮤텍스, 세마포어 </b>는 서로 다른 방식으로 상호 배제를 달성
<br>
- <b>공유자원</b>: 시스템 안에서 각 프로세스, 스레드가 함께 접근할 수 있는 모니터, 프린터, 파일, 데이터 등의 자원이나 변수
- <b>Race Condition(경쟁 상태)</b>: 공유자원을 두 개 이상의 프로세스가 동시에 사용하는 상태
- <b>상호배제</b>: 임계영역에 하나 이상의 프로세스가 들어갈 수 없다 -> 뮤텍스와 세마포어로 달성 가능
- <b>Critical Section(임계 영역)</b>: <b>둘 이상</b>의 프로세스, 스레드가 공유 자원에 접근할 때, 순서 등의 이유로 <b>결과가 달라지는 코드 영역</b>
   - 해결 방법: 뮤텍스, 세마포어, 모니터

# :ribbon: Mutex(뮤텍스)
: 프로세스나 스레드가 공유 자원을 lock()하여 잠금 설정하여 사용, 사용 후에는 unlock()으로 잠금 해제
- lock을 하면 다른 프로세스/스레드는 잠긴 코드 영역에 접근 불가
- 뮤텍스는 잠금/잠금해제 <b>2가지 상태</b>만을 가진다<br>
![image](https://github.com/AucSuSu/CS-study/assets/75782242/6cdd0e6f-837d-4237-bd0e-1434711258d9)
<br>
: 한 스레드나 프로세스에 의해 소유될 수 있는 key를 기반으로 한 상호배제 기법<br>
: <b>key</b>에 해당하는 어떤 오브젝트가 있으며 이 오브젝트(=key)를 <b>소유한 스레드/프로세스만이 공유 자원에 접근 가능</b>
<br>
## 과정
1. 1번 프로세스가 자원에 접근하기 위해 key 점유<br>
   -> 1번 프로세스가 key를 점유하여 공유자원 사용
2. 2번 프로세스도 공유 자원을 사용하고 싶음<br>
  -> key가 없기 때문에 key 점유를 위해 <b>대기</b>
3. 3번 프로세스도 공유 자원을 사용하고 싶음<br>
  -> key가 없기 때문에 key 점유를 위해 2번 프로세스 다음 순서로 <b>대기</b>
4. 1번 프로세스가 공유자원을 다 사용하고 key 반환
5. 2번 프로세스가 대기하고 있다가 반환된 key를 점유하여 공유자원 사용
6. 2번 프로세스의 key 점유가 끝나면 3번 프로세스가 key를 점유하여 공유자원 사용 후 반환

<br>

# :ribbon: Semaphore(세마포어)
![image](https://github.com/AucSuSu/CS-study/assets/75782242/c2e4a2c8-9567-4a82-95dd-094ca2d914b4)
: 현재 공유 자원에 접근할 수 있는 스레드나 프로세스의 수를 나타내는 값을 두어 상호배제 달성
: 공유자원에 접근할 수 있는 <b>최대 허용치만큼</b> 동시 사용자(스레드, 프로세스) 접근을 허용

- 간단한 정수 값, wait(), signal()로 공유 자원 접근 처리
  - wait(): 자신의 차례가 올 때까지 기다리는 함수
  - signal(): 다음 프로세스로 순서를 넘겨주는 함수
  - 공유 자원에 접근하면 세마포어에서 wait() 작업 수행하고 공유 자원 해제 후, 세마포어에서 signal() 작업 수행

## 과정
1. 공유 자원에 대한 최대 허용치 정의(일단 동시 사용자 허용치를 3으로 정의)
2. 1번 프로세스가 공유자원에 접근 -> 허용치 2로 감소
3. 2번 프로세스가 공유자원에 접근 -> 허용치 1로 감소
4. 3번 프로세스가 공유자원에 접근 -> 허용치 0으로 감소
5. 4번 프로세스가 공유자원에 접근 -> 허용치 0이므로 <b>대기</b>
6. 2번 프로세스가 공유자원을 다 사용하여 떠남 -> 허용치 1로 증가
7. 대기 중인 4번 프로세스가 공유자원에 접근 -> 허용치 0으로 감소
<br>

# :confetti_ball: Mutex/Semaphore 차이점
- Semaphore는 Mutex가 될 수 있지만(Semaphore는 일반화된 Mutex이다), Mutex는 Semaphore가 될 수 없다.
- Semaphore는 소유할 수 X, Mutex는 소유할 수 있고, 소유주가 그에 대한 책임을 가질 수 있다.
- Semaphore는 동기화 대상이 여러 개일 때 사용, Mutex는 동기화 대상이 하나일 때 사용


# :round_pushpin: References
- [https://worthpreading.tistory.com/90](https://worthpreading.tistory.com/90)
- 현대 오토에버 면접에서 뮤텍스, 세마포어 꽤 물어본 걸로 알고 있습니당 ㅎ ㅎ
