# 트랜잭션(Transaction)

- DB의 상태를 변화시키기 위해 수행하는 작업의 논리적 단위
- 한꺼번에 수행되야 하는 여러 개의 연산을 하나로 묶음

## 트랜잭션의 필요성

- 트랜잭션은 DB가 완전성(integrity)을 유지할 수 있도록 사용자에게 확신을 준다.
- 논리적인 작업 셋을 모두 완벽하게 처리하거나, 혹은 처리하지 못한 경우는 원 상태로 복구해서 작업의 일부만 적용되는 현상이 발생하지 않도록 한다.
- 트랜잭션의 결과는 commit과 rollback 두 개로 구분된다. 

### Commit

1. 하나의 트랜잭션에 속한 모든 작업을 성공하면 Commit이라 한다.
2. 모든 작업을 정상적으로 처리하겠다고 확정하는 명령어로, 처리과정을 DB에 영구 저장한다.
3. Commit을 수행하면 하나의 트랜잭션 과정을 종료하는 것이며, 이전 데이터가 완전히 UPDATE 된다.
![commit](https://github.com/AucSuSu/CS-study/assets/139415941/9ca84d58-2b6d-4b77-a385-b207b26e3eb7)

### Rollback

1. 하나의 트랜잭션에 속한 작업 중 단 하나라도 실패하면 Rollbak이라 한다.
2. Rollback이 발생하면 모든 데이터를 해당 트랜잭션이 시작되기 이전의 상태로 되돌린다.
3. 즉, 마지막 Commit을 완료한 시점으로 복구한다.
![rollback](https://github.com/AucSuSu/CS-study/assets/139415941/33c582aa-f9c2-4883-9f43-859634f6c032)

<br>

## 트랜잭션의 특성(ACID)
- 트랜잭션은 DB에 대한 완전성을 유지하기 위해 다음과 같이 4개의 특성을 지니며, 흔히 각 특성의 앞글자를 따 ACID라고 부른다.
![acid](https://github.com/AucSuSu/CS-study/assets/139415941/e319db24-1be3-4ef0-a902-8d4734a1963b)
- ACID는 특히 주식, 금융, 웹 쇼핑몰 등의 프로덕션 시스템을 실행하는데 최적화 되어있다.

<br>
❗️Atomicity(원자성)

- 트랜잭션의 안전성 보장을 위하여, 작업이 모두 반영되거나 모두 반영되지 않음으로서 결과를 예측할 수 있어야 한다.
All or nothing 
```
A계좌에서 출금하여 B계좌로 입금하는 트랜잭션이 있는 경우,

1. 출금과 입금이 둘 다 성공적으로 이뤄지면 트랜잭션을 commit한다(All)
2. 출금과 입금 둘 중 어느 하나라도 작업이 실패할 경우 모든 작업을 rollback 하여 기존 데이터를 보호한다(Nothing)
```

<br>
❗️Consistency(일관성)

- 하나의 트랜잭션 이전과 이후, DB의 상태는 동일하게 유효해야 한다.
- DB의 상태가 유효하다는 것은 정해진 DB의 제약이나 규칙을 만족해야 한다는 뜻이다.
```
‘모든 고객은 반드시 이름을 가지고 있어야 한다’는 데이터베이스의 제약이 있다고 가정한다.

이때, 다음과 같은 트랜잭션은 Consistency(일관성)를 위반한다.
이름 없는 새로운 고객을 추가하는 쿼리, 기존 고객의 이름을 삭제하는 쿼리 등
```

<br>
❗️Isolation(격리성, 고립성, 독립성)

- 트랜잭션 수행 시 다른 트랜잭션의 작업이 끼어질도 못하도록 보장한다.
- 하나의 트랜잭션 밖에 있는 어떤 연산도 해당 트랜잭션의 중간 단계 데이터를 볼 수 없음을 의미한다.
- 둘 이상의 트랜잭션이 동시에 병행 실행되는 중 다른 트랜잭션의 영향을 받아 잘못된 결과를 만들지 않기 위해 독립성이 보장되어야 한다.
```
트랜잭션1 :  A계좌에서 출금하여 B계좌로 돈을 보내는 작업 중, A계좌에서 출금만 된 상황
트랜잭션2 :  User가 모든 계좌(A계좌, B계좌)의 예금액을 조회하는 경우

격리성이 보장되지 않는 경우 User가 조회한 예금액은 실제 Total 예금액보다 A계좌에서 출금된 만큼 적을 수 있다.
```

<br>
❗️Durability(지속성, 영속성)

- 성공적으로 수행되어 Commit연산을 실행핬다면, 해당 트랜잭션은 DB에 영구 반영(Log)되어야 한다.
```
하나의 트랜잭션이 성공된 이후, DB에 에러가 생기더라도 성공한 트랜잭션의 Log는 기록으로 남아야 한다.
만약 트랜잭션의 Log가 남겨지기 전, 에러가 발생했다면 해당 트랜잭션의 모든 작업은 rollback이 되어야 한다.
```

<br>

# 레퍼런스
[https://hanamon.kr/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98-acid-%EC%84%B1%EC%A7%88/](https://hanamon.kr/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98-acid-%EC%84%B1%EC%A7%88/)